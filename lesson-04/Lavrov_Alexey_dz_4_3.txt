mysql> USE vk;
Database changed

mysql> ALTER TABLE profiles ADD COLUMN is_active BOOL NOT NULL DEFAULT TRUE;
ERROR 1060 (42S21): Duplicate column name 'is_active'

mysql> ALTER TABLE profiles DROP COLUMN is_active;
Query OK, 0 rows affected (2.69 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> ALTER TABLE profiles ADD COLUMN is_active BOOL NOT NULL DEFAULT TRUE;
Query OK, 0 rows affected (1.09 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql>  DESCRIBE profiles;
+-----------+-------------------+------+-----+---------+----------------+
| Field     | Type              | Null | Key | Default | Extra          |
+-----------+-------------------+------+-----+---------+----------------+
| user_id   | bigint unsigned   | NO   | PRI | NULL    | auto_increment |
| gender    | enum('f','m','x') | NO   |     | NULL    |                |
| birthday  | date              | NO   |     | NULL    |                |
| photo_id  | bigint unsigned   | YES  |     | NULL    |                |
| country   | varchar(130)      | YES  |     | NULL    |                |
| city      | varchar(130)      | YES  |     | NULL    |                |
| is_active | tinyint(1)        | NO   |     | 1       |                |
+-----------+-------------------+------+-----+---------+----------------+
7 rows in set (0.01 sec)

mysql> SELECT * FROM profiles LIMIT 10;
+---------+--------+------------+----------+--------------+-----------+-----------+
| user_id | gender | birthday   | photo_id | country      | city      | is_active |
+---------+--------+------------+----------+--------------+-----------+-----------+
|       1 | f      | 2003-09-08 |       36 | Uganda       | Glendon   |         1 |
|       2 | x      | 2003-09-09 |       95 | Montserrat   | Cod?      |         1 |
|       3 | f      | 2003-09-10 |       12 | Sudan        | B?gles    |         1 |
|       4 | m      | 2003-10-09 |       71 | Paraguay     | Charny    |         1 |
|       5 | f      | 1985-01-16 |       65 | Aruba        | Cromer    |         1 |
|       6 | f      | 1998-04-10 |       16 | South Africa | Colorno   |         1 |
|       7 | m      | 1977-07-14 |       67 | South Sudan  | Goderich  |         1 |
|       8 | f      | 1974-06-12 |       84 | Nigeria      | Lauder    |         1 |
|       9 | x      | 1993-03-12 |       30 | Gibraltar    | Bhakkar   |         1 |
|      10 | f      | 1984-05-06 |       32 | Peru         | Moignelee |         1 |
+---------+--------+------------+----------+--------------+-----------+-----------+
10 rows in set (0.00 sec)

mysql> UPDATE profiles SET birthday = (CURRENT_DATE() - INTERVAL 18 YEAR - INTERVAL 1 DAY) WHERE user_id = 1;
Query OK, 0 rows affected (0.00 sec)
Rows matched: 1  Changed: 0  Warnings: 0

mysql> UPDATE profiles SET birthday = (CURRENT_DATE() - INTERVAL 18 YEAR) WHERE user_id = 2;
Query OK, 0 rows affected (0.00 sec)
Rows matched: 1  Changed: 0  Warnings: 0

mysql> UPDATE profiles SET birthday = (CURRENT_DATE() - INTERVAL 18 YEAR + INTERVAL 1 DAY) WHERE user_id = 3;
Query OK, 0 rows affected (0.00 sec)
Rows matched: 1  Changed: 0  Warnings: 0

mysql> SELECT
    ->     user_id,
    ->     birthday,
    ->     (YEAR(CURRENT_DATE()) - YEAR(birthday)) - (RIGHT(CURRENT_DATE(), 5) < RIGHT(birthday, 5)) AS 'age'
    ->     FROM profiles ORDER BY age LIMIT 10;
+---------+------------+------+
| user_id | birthday   | age  |
+---------+------------+------+
|       3 | 2003-09-10 |   17 |
|       4 | 2003-10-09 |   17 |
|       1 | 2003-09-08 |   18 |
|       2 | 2003-09-09 |   18 |
|      55 | 2002-05-01 |   19 |
|      74 | 2000-11-25 |   20 |
|      19 | 2001-07-11 |   20 |
|     100 | 2000-10-24 |   20 |
|      73 | 2001-08-23 |   20 |
|      14 | 2000-03-17 |   21 |
+---------+------------+------+
10 rows in set (0.00 sec)

mysql> SELECT
    ->     user_id, birthday,
    ->     (
    ->         (YEAR(CURRENT_DATE) - YEAR(birthday)) -                             -- step 1
    ->         (DATE_FORMAT(CURRENT_DATE, '%m%d') < DATE_FORMAT(birthday, '%m%d')) -- step 2
    ->     ) AS age
    ->     FROM profiles ORDER BY age LIMIT 10;
+---------+------------+------+
| user_id | birthday   | age  |
+---------+------------+------+
|       3 | 2003-09-10 |   17 |
|       4 | 2003-10-09 |   17 |
|       1 | 2003-09-08 |   18 |
|       2 | 2003-09-09 |   18 |
|      55 | 2002-05-01 |   19 |
|      74 | 2000-11-25 |   20 |
|      19 | 2001-07-11 |   20 |
|     100 | 2000-10-24 |   20 |
|      73 | 2001-08-23 |   20 |
|      14 | 2000-03-17 |   21 |
+---------+------------+------+
10 rows in set (0.03 sec)


????????????????????????????????????????????????????
mysql> UPDATE profiles
    ->     SET is_active = FALSE
    ->     WHERE
    ->         (SELECT (
    ->                  (YEAR(CURRENT_DATE) - YEAR(birthday)) -
    ->                  (DATE_FORMAT(CURRENT_DATE, '%m%d') < DATE_FORMAT(birthday, '%m%d'))
    ->                  )  < 18
    ->                  FROM profiles);
ERROR 1093 (HY000): You can't specify target table 'profiles' for update in FROM clause
????????????????????????????????????????????????????


mysql> SELECT user_id, birthday, (TIMESTAMPDIFF(YEAR, birthday, CURRENT_DATE())) AS 'age' FROM profiles LIMIT 10;
+---------+------------+------+
| user_id | birthday   | age  |
+---------+------------+------+
|       1 | 2003-09-08 |   18 |
|       2 | 2003-09-09 |   18 |
|       3 | 2003-09-10 |   17 |
|       4 | 2003-10-09 |   17 |
|       5 | 1985-01-16 |   36 |
|       6 | 1998-04-10 |   23 |
|       7 | 1977-07-14 |   44 |
|       8 | 1974-06-12 |   47 |
|       9 | 1993-03-12 |   28 |
|      10 | 1984-05-06 |   37 |
+---------+------------+------+
10 rows in set (0.00 sec)

mysql> UPDATE profiles
    ->  SET is_active = FALSE
    ->  WHERE
    ->          TIMESTAMPDIFF(YEAR, birthday, CURRENT_DATE()) < 18;
Query OK, 2 rows affected (0.09 sec)
Rows matched: 2  Changed: 2  Warnings: 0

mysql> SELECT *, (TIMESTAMPDIFF(YEAR, birthday, CURRENT_DATE())) AS 'age' FROM profiles WHERE is_active = FALSE;
+---------+--------+------------+----------+----------+--------+-----------+------+
| user_id | gender | birthday   | photo_id | country  | city   | is_active | age  |
+---------+--------+------------+----------+----------+--------+-----------+------+
|       3 | f      | 2003-09-10 |       12 | Sudan    | B?gles |         0 |   17 |
|       4 | m      | 2003-10-09 |       71 | Paraguay | Charny |         0 |   17 |
+---------+--------+------------+----------+----------+--------+-----------+------+
2 rows in set (0.00 sec)